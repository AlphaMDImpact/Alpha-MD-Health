@namespace AlphaMDHealth.WebClient
@inherits BasePage
@page "/CaregiverAddEdit"
@page "/CaregiverAddEdit/{patientcaregiverid:long}"

@if (_isDataFetched)
{
    <BasePage @bind-Error=@Error
              @bind-Success=@Success
              CurrentPage=@this
              PageTitle=@LibPermissions.GetFeatureText(AppState.MasterData.OrganisationFeatures, AppPermissions.CaregiverAddEdit.ToString())
              PageResources=@_caregiverData.Resources
              RegisterComp=@RegisterControl
              OnClose=@OnClose
              ApplyFixedFooter=true
              ApplyCard=true
              IsAccordion=@IsAccordion
              ShowDetailPage=@ShowDetailPage
              PageOperation=@GetPageOperationType(_isEditable, PatientCaregiverID == 0)>
        <ChildContent>
            <AmhDropdownControl @bind-Options=@_caregiverData.Organisations
                                ResourceKey=@ResourceConstants.R_ORGANISATION_KEY
                                IsControlEnabled=@_isEditable />

            <AmhDropdownControl @bind-Options=@_caregiverData.Branches
                                OnValueChanged=@(e => OnBranchChanged(e,true))
                                ResourceKey=@ResourceConstants.R_BRANCH_KEY
                                IsControlEnabled=@_isEditable/>

            <AmhDropdownControl @bind-Options=@_caregiverData.DepartmentList
                                OnValueChanged=@(e => OnDepartmentChanged(e,true))
                                ResourceKey=@ResourceConstants.R_DEPARTMENT_KEY
                                IsControlEnabled=@_isEditable />

            <AmhDropdownControl @bind-Options=@_caregiverData.CaregiverList
                                ResourceKey=@ResourceConstants.R_CAREGIVER_KEY
                                IsControlEnabled=@_isEditable />

            @if (_caregiverData.Caregiver.ProgramCareGiverID > 0)
            {
                <AmhLabelControl FieldType=@FieldTypes.PrimarySmallHStartVCenterLabelControl
                                 ResourceKey=@ResourceConstants.R_PROGRAM_TITLE_KEY />

                <AmhLabelControl FieldType=@FieldTypes.PrimarySmallHStartVCenterBoldLabelControl
                                 Value=@_caregiverData.Caregiver.ProgramName />
            }
            <AmhDateTimeControl @bind-Value=@_caregiverData.Caregiver.FromDate
                                ResourceKey=@ResourceConstants.R_START_DATE_KEY
                                IsControlEnabled=@_isEditable />

            <AmhDateTimeControl @bind-Value=@_caregiverData.Caregiver.ToDate
                                ResourceKey=@ResourceConstants.R_END_DATE_KEY
                                IsControlEnabled=@_isEditable />
        </ChildContent>
        <PageFooter>
            @if (_caregiverData.Caregiver.PatientCareGiverID > 0 && _isEditable && LibPermissions.HasPermission(_caregiverData.FeaturePermissions, AppPermissions.CaregiverDelete.ToString()))
            {
                <AmhButtonControl ResourceKey=@ResourceConstants.R_DELETE_ACTION_KEY
                                  OnValueChanged=@OnRemoveClick />

                <AmhMessageControl ResourceKey=@ResourceConstants.R_DELETE_CONFIRMATION_KEY
                                   ShowHidePopup=@_hideConfirmationPopup
                                   Actions=@_actionData
                                   OnValueChanged=@OnDeleteConfirmationPopUpClickedAsync />
            }
            @if (_isEditable)
            {
                <AmhButtonControl ResourceKey=@ResourceConstants.R_SAVE_ACTION_KEY
                                  OnValueChanged=@OnSaveButtonClickedAsync />
            }
            <AmhButtonControl ResourceKey=@ResourceConstants.R_CANCEL_ACTION_KEY
                              OnValueChanged=OnCancelClickedAsync />
        </PageFooter>
    </BasePage>
}