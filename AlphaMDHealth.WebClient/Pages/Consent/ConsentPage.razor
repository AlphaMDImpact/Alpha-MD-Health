@inherits BasePage
@namespace AlphaMDHealth.WebClient

@if (_isDataFetched)
{
    <BasePage @bind-Error=@Error
              @bind-Success=@Success
              CurrentPage=@this
              PageTitle=@LibPermissions.GetFeatureText(AppState.MasterData.OrganisationFeatures, AppPermissions.ConsentAddEdit.ToString())
              OnClose=@OnClose
              PageResources=@_consentData?.Resources
              RegisterComp=@RegisterControl
              ApplyFixedFooter=true
              IsAccordion=@IsAccordion
              ShowDetailPage=@ShowDetailPage
              ApplyCard=true
              PageOperation=@GetPageOperationType(_isEditable, ConsentID == 0)>
        <ChildContent>
            <AmhDropdownControl @bind-Options=@_consentData.Roles
                                ResourceKey=@ResourceConstants.R_CONSENT_ROLE_KEY
                                IsControlEnabled=@_isEditable />

            <AmhDropdownControl @bind-Options=@_consentData.Pages
                                ResourceKey=@ResourceConstants.R_CONSENT_PAGE_KEY
                                IsControlEnabled=@_isEditable />

            <AmhNumericEntryControl @bind-Value=@_sequenceValue
                                    ResourceKey=@ResourceConstants.R_SEQUENCE_NO_KEY
                                    IsControlEnabled=@_isEditable />

            <AmhCheckBoxListControl @bind-Value=@_consentData.Consent.ConsentFor
                                    Options=_consentData.ConsentPlatforms
                                    ResourceKey=@ResourceConstants.R_CONSENT_PLATFORM_KEY
                                    IsControlEnabled=@_isEditable />

            <AmhCheckBoxListControl ResourceKey=@ResourceConstants.R_IS_REQUIRED_KEY
                                    Options=@GetRememberMeOption()
                                    Value=@(_consentData.Consent.IsRequired? "1": "0")
                                    IsControlEnabled=@_isEditable
                                    ValueChanged=@OnRememberMeClicked />
        </ChildContent>
        <PageFooter>
            @if (_consentData.Consent.ConsentID > 0 && LibPermissions.HasPermission(_consentData.FeaturePermissions, AppPermissions.ConsentDelete.ToString()))
            {
                <AmhButtonControl ResourceKey=@ResourceConstants.R_DELETE_ACTION_KEY OnValueChanged=@OnRemoveClick />
                <AmhMessageControl ResourceKey=@ResourceConstants.R_DELETE_CONFIRMATION_KEY
                                   ShowHidePopup=@_hideDeletedConfirmationPopup
                                   Actions=@_messageButtonActions
                                   OnValueChanged=@OnConsentActionClickAsync />
            }
            @if (_isEditable)
            {
                <AmhButtonControl ResourceKey=@ResourceConstants.R_SAVE_ACTION_KEY OnValueChanged=@OnSaveButtonClickedAsync />
            }
            <AmhButtonControl ResourceKey=@ResourceConstants.R_CANCEL_ACTION_KEY OnValueChanged=@OnCancelClickedAsync />
        </PageFooter>
    </BasePage>
}